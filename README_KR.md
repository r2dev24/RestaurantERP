# RestaurantERP - Development
**레스토랑 지점, 사용자, 역할 관리를 위한 종합 ERP 시스템**  
기술 스택: **C#, ASP.NET Core MVC, SQL Server**


# ERP 시스템 개발 기록

## 개발 이력

### 2024년 12월 30일
1. **비밀번호 해싱**
   - `PasswordHasher`를 구현하여 비밀번호를 안전하게 해싱하여 저장.
   - 인증 과정에서 해시된 비밀번호를 검증하여 로그인 보안을 강화.

2. **로그인 로직 개선**
   - 로그인 실패 시 의미 있는 오류 메시지를 추가.
   - 유효성 검사와 예외 처리를 통해 안정성을 개선.

3. **쿠키 인증**
   - `HttpContext.SignInAsync`를 사용하여 쿠키 기반 사용자 인증 구현.
   - `Claims`를 사용해 사용자 정보(이름, 이메일, 역할)를 관리.

4. **사용자 경험 개선**
   - 로그인 실패 시 입력 값을 유지하고 오류 메시지를 표시.
   - 로그인 성공 시 사용자를 대시보드로 리디렉션.

---

### 2024년 12월 29일
1. **컨트롤러 설정**
   - 급여 관련 요청을 처리하기 위해 `PayController`를 생성.
   - `AppDbContext`를 사용하여 컨트롤러를 데이터베이스에 연결.
   - `ViewData`를 사용하여 직원 데이터를 컨트롤러에서 뷰로 전달.
   - `Payroll` 메서드를 구현하여 직원 목록을 가져와 뷰에서 렌더링.

2. **뷰 구현**
   - 페이지 제목을 "Payroll | ERP"로 설정.
   - 직원 목록을 동적으로 표시하기 위한 드롭다운 메뉴 설계.
   - Bootstrap을 활용하여 깔끔하고 반응형 UI 구현.

3. **워크플로우**
   - **데이터 검색:** 컨트롤러가 데이터베이스에서 직원 데이터를 검색.
   - **데이터 전달:** 검색된 데이터를 `ViewData`를 통해 뷰로 전달.
   - **뷰 렌더링:** 뷰가 직원 데이터를 사용하여 드롭다운 메뉴를 생성.
   - **사용자 상호작용:** 사용자가 드롭다운 메뉴에서 직원을 선택할 수 있도록 하여 추가 기능 구현의 기반을 마련.

---

### 2024년 12월 28일
1. **직원 목록 뷰**
   - `BranchMemberViewModel` 데이터를 테이블 형식으로 표시.
   - 포함된 열:
      - 지점
      - 역할
      - 이름
      - 생년월일
      - 연락처
      - 작업(상세 보기 및 삭제 버튼)

2. **상세 보기 모달**
   - 선택한 직원의 세부 정보를 표시하기 위한 Bootstrap 기반 모달 구현.
   - "상세 보기" 버튼 클릭 시 모달 내용이 동적으로 업데이트됨.

3. **동적 데이터 로딩**
   - `data-id` 속성을 사용하여 선택된 직원을 식별.
   - JavaScript(fetch API)를 사용하여 서버에서 직원 세부 정보를 가져옴.
   - 가져온 Partial View를 모달에 동적으로 삽입.

4. **Partial View 통합**
   - Partial View(`_EmployeeDetailPartial`)에서 다음 정보를 표시:
      - 직원 이름
      - 역할
      - 지점
      - 생년월일
      - 연락처

5. **페이지네이션**
   - 직원 목록에 페이지네이션 추가.
   - 표시 내용:
      - 페이지 번호
      - 이전/다음 버튼
   - `CurrentPage`와 `TotalPages` 값을 사용해 상태를 유지.

6. **버그 수정**
   - JavaScript의 `this.getAttribute` 관련 오류 해결.
   - 누락된 `#modalContent` 문제를 `.modal-content`로 대체하여 수정.

7. **삭제 버튼 업데이트**
   - Razor View에서 `asp-route-email` 대신 `asp-route-id`를 사용하여 `MemberID`를 컨트롤러로 전달.

8. **컨트롤러 로직 개선**
   - **`DeleteEmployee` 메서드**:
      - 제공된 `MemberID`를 사용해 직원을 검색.
      - 처리 시나리오:
         - 직원 기록이 없으면:
            - 정보 로그를 남기고 `Index` 페이지로 리디렉션.
         - 삭제 성공 시:
            - 데이터베이스에서 직원을 삭제 후 `EmployeeList` 페이지로 리디렉션.
         - 삭제 실패 시:
            - 오류를 기록하고 오류 페이지로 리디렉션.

9. **Razor View 개선**
   - `asp-route-id` 속성을 사용해 삭제 버튼을 간소화.
   - 테이블 구조에서 상세 보기와 삭제 버튼을 정리.

10. **오류 처리 강화**
    - `DeleteEmployee` 메서드에서:
       - 직원 기록이 null인 경우 즉시 리디렉션.
       - 예외를 상세히 기록하여 디버깅을 용이하게 함.

---

### 2024년 12월 27일
1. **직원 추가 폼**
   - 지점, 역할, 직원 정보를 입력받기 위한 폼을 생성.

2. **드롭다운 리스트**
   - 데이터베이스에서 지점과 역할 데이터를 가져와 드롭다운 리스트에 표시.

3. **컨트롤러 (EmployeeController)**
   - **Index:** 메인 뷰를 반환.
   - **AddEmployee:** 데이터베이스에서 지점과 역할 목록을 가져와 뷰로 전달.
   - **AddNewMember:** 폼 데이터를 검증한 후, 새로운 직원 정보와 주소, 역할 데이터를 데이터베이스에 저장.

4. **추가 작업**
   - **데이터 검색:** BranchMembers, MemberRoles, MemberAddresses, BranchRoles, Branches 데이터를 비동기로 가져옴.
   - **ViewModel 생성:** 각 회원의 주소, 역할, 지점 정보를 결합하여 `BranchMemberViewModel` 생성.
   - **Razor View에 데이터 표시:** Razor View에서 `BranchMemberViewModel` 목록을 테이블 형식으로 표시.

---

### 2024년 12월 26일
1. **상세 보기 버튼 업데이트**
   - `data-email` 속성을 추가하여 각 사용자의 이메일을 동적으로 전달.
   - Ajax 요청을 구성하여 원활한 서버 통신 구현.

2. **JavaScript Ajax 요청**
   - `fetch`를 사용해 서버에서 Partial View 데이터를 가져옴.
   - 가져온 데이터를 모달 콘텐츠에 동적으로 삽입.

3. **컨트롤러 구현**
   - `GetUserDetail` 액션을 생성하여 이메일로 사용자 정보를 가져오고 Partial View 반환.

4. **Partial View**
   - `_UserDetail.cshtml`을 설계하여 사용자 이름, 이메일, 연락처 정보를 표시.

5. **데이터베이스 설계**
   - 외래 키 관계를 가진 `Branch`와 `BranchAddress` 테이블 설계.

6. **지점 관리**
   - `BranchController`를 생성하고 `AddNewBranch` 액션 구현.
   - 로그인된 사용자의 이메일을 통해 계정을 가져오고 지점 데이터 저장.

7. **지점 추가 뷰**
   - `AddBranch` Razor View를 생성하여 지점 생성 폼을 구현.
   - `asp-for`와 Bootstrap을 사용해 UI 스타일링 및 유효성 검사 추가.

8. **버그 수정**
   - 유효성 검사 오류를 기록하여 디버깅 개선.
   - 외래 키 관계 및 데이터 저장과 관련된 문제 해결.

---

### 2024년 12월 25일
1. **삭제 기능**
   - 이메일을 기반으로 사용자를 삭제하는 로직 구현.
   - `FirstOrDefaultAsync`를 사용해 사용자 데이터를 검색 후 삭제.
   - 삭제 성공 시 사용자 목록 페이지로 리디렉션.

---

### 2024년 12월 24일
1. **로그인 뷰**
   - **공개 및 인증된 접근:**
      - 공개 접근: `Home/Index`
      - 인증된 사용자만 접근 가능: `Main/Index`
      - `Claims`를 사용해 인증 관리.

2. **컨트롤러**
   - `Home` 및 `Main`: 뷰 컨트롤러.
   - `AuthController`: 로그인 및 로그아웃 관리.

3. **ERP 사용자 관리**
   - Bootstrap 스타일의 테이블에서 사용자 역할, 이메일, 이름, 연락처 정보 표시.
   - 각 사용자에 대해 삭제 및 상세 보기 버튼 추가.
   - `switch` 문을 사용해 동적 역할 표시 구현.
   - Bootstrap 디자인을 활용하여 대규모 데이터셋에 페이지네이션 지원.

4. **향후 계획**
   - 삭제, 상세 보기, 검색 및 필터링 기능 추가 예정.


